#!/usr/bin/env node

var program = require('commander');
var pkg = require('../package.json');
var output = require('../lib/output');
var tape = require('tape');

program
  .version(pkg.version);

program
  .usage('<command> <options>')
  .command('swagger <swagger.json>')
  .option('-v, --validate', 'Validate swagger file.')
  .option('-x, --xunit', 'Output xunit.')
  .description('Swagger utils.')
  .action(function (swaggerFile, options) {
    var opts = options;
    opts.tape = tape;
    opts.testFile = './swagger-tests.js';
    opts.swaggerFile = swaggerFile;
    output.action(opts).pipe(process.stdout);
  });

program
  .usage('<command> <options>')
  .command('js <tests.js>')
  .option('-x, --xunit', 'Output xunit.')
  .description('Run tape tests.')
  .action(function (testFile, options) {
    console.log('js', testFile);
    var opts = options;
    opts.tape = tape;
    opts.testFile = testFile;
    output.action(opts).pipe(process.stdout);
  });


program.on('--help', function (){
  console.log('  Examples:');
  console.log('');
  console.log('    $ rotan swagger swagger.json');
  console.log('    $ rotan js index.js');
  console.log('');
});


program.parse(process.argv);

if (!process.argv.slice(2).length) {
  program.outputHelp();
}
